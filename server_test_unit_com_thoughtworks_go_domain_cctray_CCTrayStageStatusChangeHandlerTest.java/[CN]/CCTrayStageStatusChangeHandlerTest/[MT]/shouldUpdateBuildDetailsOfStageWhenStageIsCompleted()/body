{
  String projectName="pipeline :: stage1";
  Stage completedStage=StageMother.createPassedStage("pipeline",1,"stage1",1,"job1",new Date());
  completedStage.setCompletedByTransitionId(1L);
  CCTrayStageStatusChangeHandler handler=new CCTrayStageStatusChangeHandler(cache,jobStatusChangeHandler,breakersCalculator);
  handler.call(completedStage);
  verify(cache).replace(eq(projectName),statusCaptor.capture());
  assertThat(completedStage.isCompleted(),is(true));
  assertThat(statusCaptor.getValue().getLastBuildStatus(),is("Success"));
  assertThat(statusCaptor.getValue().getLastBuildTime(),is(completedStage.completedDate()));
  assertThat(statusCaptor.getValue().getLastBuildLabel(),is("LABEL-1"));
}
