{
  CCTrayStageStatusChangeHandler handler=new CCTrayStageStatusChangeHandler(cache,jobStatusChangeHandler,breakersCalculator);
  Stage stage=StageMother.custom("stage1",JobInstanceMother.building("job1"));
  when(breakersCalculator.calculateFor(stage)).thenReturn(s("breaker1","breaker2"));
  handler.call(stage);
  verify(cache).replace(eq("pipeline :: stage1"),statusCaptor.capture());
  assertThat(statusCaptor.getValue().getBreakers(),is(s("breaker1","breaker2")));
}
