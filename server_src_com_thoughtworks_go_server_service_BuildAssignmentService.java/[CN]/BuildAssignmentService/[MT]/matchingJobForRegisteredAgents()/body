{
  agentRemoteHandler.connectedAgents().forEach(new BiConsumer<String,Agent>(){
    @Override public void accept(    String agentUUId,    Agent agent){
      AgentInstance agentInstance=agentService.findAgentAndRefreshStatus(agentUUId);
      if (agentInstance.isRegistered() && !agentInstance.isDisabled() && agentInstance.isIdle()) {
        Work work=BuildAssignmentService.this.assignWorkToAgent(agentInstance);
        if (work != NO_WORK) {
          agent.send(new AssignWork(work));
        }
      }
    }
  }
);
}
