{
  ConfigRepoConfig configRepo=configWatchList.getCurrentConfigRepos().get(0);
  PartialConfig badPart=new PartialConfig(new PipelineGroups(PipelineConfigMother.createGroup("part1",PipelineConfigMother.pipelineConfig("pipe1"),PipelineConfigMother.pipelineConfig("pipe1"))));
  when(plugin.load(any(File.class),any(PartialConfigLoadContext.class))).thenReturn(badPart);
  ConfigChangedListener listener=mock(ConfigChangedListener.class);
  cachedGoConfig.registerListener(listener);
  verify(listener,times(1)).onConfigChange(any(CruiseConfig.class));
  repoConfigDataSource.onCheckoutComplete(configRepo.getMaterialConfig(),folder,"321e");
  assertThat("currentConfigShouldBeMainXmlOnly",cachedGoConfig.currentConfig(),is(cachedFileGoConfig.currentConfig()));
  verify(listener,times(1)).onConfigChange(any(CruiseConfig.class));
}
