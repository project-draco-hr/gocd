{
  CruiseConfig cruiseConfig=goConfigService.currentCruiseConfig();
  Material material=new MaterialConfigConverter().toMaterial(materialConfig);
  ValueStreamMap valueStreamMap=new ValueStreamMap(material,materialInstance,modification);
  Map<String,List<PipelineConfig>> pipelineToDownstreamMap=cruiseConfig.generatePipelineVsDownstreamMap();
  traverseDownstream(materialConfig.getFingerprint(),downstreamPipelines,pipelineToDownstreamMap,valueStreamMap,new ArrayList<PipelineConfig>());
  addInstanceInformationToTheGraph(valueStreamMap);
  removeRevisionsBasedOnPermissionAndCurrentConfig(valueStreamMap,username);
  return valueStreamMap;
}
