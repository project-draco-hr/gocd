{
  RailsAssetsService railsAssetsService=getRailsAssetsService();
  velocityContext.put(ADMINISTRATOR,true);
  velocityContext.put(GROUP_ADMINISTRATOR,true);
  velocityContext.put(TEMPLATE_ADMINISTRATOR,true);
  velocityContext.put(VIEW_ADMINISTRATOR_RIGHTS,true);
  velocityContext.put(USE_COMPRESS_JS,systemEnvironment.useCompressedJs());
  Boolean useNewRails=systemEnvironment.get(SystemEnvironment.USE_NEW_RAILS);
  velocityContext.put(USE_NEW_RAILS,useNewRails);
  if (useNewRails) {
    velocityContext.put(CONCATENATED_JAVASCRIPT_FILE_PATH,railsAssetsService.getAssetPath("application.js"));
    velocityContext.put(CONCATENATED_APPLICATION_CSS_FILE_PATH,railsAssetsService.getAssetPath("application.css"));
    velocityContext.put(CONCATENATED_VM_APPLICATION_CSS_FILE_PATH,railsAssetsService.getAssetPath("vm/application.css"));
    velocityContext.put(CONCATENATED_CSS_APPLICATION_CSS_FILE_PATH,railsAssetsService.getAssetPath("css/application.css"));
    velocityContext.put(CONCATENATED_STAGE_BAR_CANCELLED_ICON_FILE_PATH,railsAssetsService.getAssetPath("g9/stage_bar_cancelled_icon.png"));
    velocityContext.put(CONCATENATED_SPINNER_ICON_FILE_PATH,railsAssetsService.getAssetPath("spinner.gif"));
    velocityContext.put(CONCATENATED_CRUISE_ICON_FILE_PATH,railsAssetsService.getAssetPath("cruise.ico"));
    velocityContext.put(PATH_RESOLVER,railsAssetsService);
  }
 else {
    velocityContext.put(CONCATENATED_JAVASCRIPT_FILE_PATH,"compressed/all.js?#include(\"admin/admin_version.txt.vm\")");
  }
  SecurityContext securityContext=(SecurityContext)request.getSession().getAttribute(SPRING_SECURITY_CONTEXT_KEY);
  if (securityContext == null || securityContext.getAuthentication() == null) {
    return;
  }
  final Authentication authentication=securityContext.getAuthentication();
  setPrincipal(velocityContext,authentication);
  setAdmininstratorRole(velocityContext,authentication);
}
