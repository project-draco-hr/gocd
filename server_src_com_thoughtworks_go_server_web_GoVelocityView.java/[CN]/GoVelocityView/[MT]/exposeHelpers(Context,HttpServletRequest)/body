{
  velocityContext.put(ADMINISTRATOR,true);
  velocityContext.put(GROUP_ADMINISTRATOR,true);
  velocityContext.put(TEMPLATE_ADMINISTRATOR,true);
  velocityContext.put(VIEW_ADMINISTRATOR_RIGHTS,true);
  velocityContext.put(USE_COMPRESS_JS,systemEnvironment.useCompressedJs());
  Boolean useNewRails=systemEnvironment.get(SystemEnvironment.USE_NEW_RAILS);
  velocityContext.put(USE_NEW_RAILS,useNewRails);
  if (useNewRails) {
    if (systemEnvironment.useCompressedJs()) {
      RailsAssetsHelper assetsHelper=new RailsAssetsHelper(((Request)request).getContext());
      velocityContext.put(COMPRESSED_JAVASCRIPT_FILE_PATH,assetsHelper.getAssetPath("application.js"));
    }
 else {
      velocityContext.put(JAVASCRIPTS_PATH_IN_DEV_ENV,"assets");
    }
  }
 else {
    velocityContext.put(COMPRESSED_JAVASCRIPT_FILE_PATH,"compressed/all.js?#include(\"admin/admin_version.txt.vm\")");
    velocityContext.put(JAVASCRIPTS_PATH_IN_DEV_ENV,"javascripts");
  }
  SecurityContext securityContext=(SecurityContext)request.getSession().getAttribute(SPRING_SECURITY_CONTEXT_KEY);
  if (securityContext == null || securityContext.getAuthentication() == null) {
    return;
  }
  final Authentication authentication=securityContext.getAuthentication();
  setPrincipal(velocityContext,authentication);
  setAdmininstratorRole(velocityContext,authentication);
}
