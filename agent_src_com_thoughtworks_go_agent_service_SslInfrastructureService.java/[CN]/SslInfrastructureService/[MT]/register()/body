{
  String hostName=SystemUtil.getLocalhostNameOrRandomNameIfNotFound();
  Registration keyEntry=null;
  while (keyEntry == null || keyEntry.getChain().length == 0) {
    File autoRegisterPropertiesFile=new File("config","autoregister.properties");
    AgentRegistrationPropertiesReader agentRegistrationPropertiesReader=new AgentRegistrationPropertiesReader(autoRegisterPropertiesFile);
    try {
      keyEntry=remoteRegistrationRequester.requestRegistration(hostName,agentRegistrationPropertiesReader);
    }
 catch (    Exception e) {
      LOGGER.error("[Agent Registration] Problems getting the Agent Certificate from Go Server",e);
      throw e;
    }
 finally {
      agentRegistrationPropertiesReader=null;
      if (autoRegisterPropertiesFile != null && autoRegisterPropertiesFile.exists()) {
        if (FileUtils.deleteQuietly(autoRegisterPropertiesFile)) {
          if (LOGGER.isDebugEnabled()) {
            LOGGER.debug("[Agent Auto Registration] Successfully deleted auto registration properties file on agent.");
          }
        }
 else {
          if (LOGGER.isDebugEnabled()) {
            LOGGER.debug("[Agent Auto Registration] Failed deleting auto registration properties file on agent.");
          }
        }
      }
    }
    try {
      Thread.sleep(REGISTER_RETRY_INTERVAL);
    }
 catch (    InterruptedException e) {
    }
  }
  LOGGER.info("[Agent Registration] Retrieved registration from Go server.");
  storeChainIntoAgentStore(keyEntry);
}
