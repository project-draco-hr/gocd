{
  agentService=mock(AgentService.class);
  systemEnvironment=mock(SystemEnvironment.class);
  goConfigService=mock(GoConfigService.class);
  when(agentService.agentJarInputStream()).thenReturn(new ByteArrayInputStream(EXPECTED.getBytes()));
  when(agentService.agentLauncherJarInputStream()).thenReturn(new ByteArrayInputStream(EXPECTED_LAUNCHER.getBytes()));
  when(systemEnvironment.getSslServerPort()).thenReturn(8443);
  controller=new AgentRegistrationController(agentService,goConfigService,systemEnvironment);
  ReflectionUtil.setField(controller,AGENT_PLUGINS_CHECKSUM_FIELD,"default");
}
