{
  String uuid="uuid";
  when(goConfigService.hasAgent(uuid)).thenReturn(false);
  ServerConfig serverConfig=new ServerConfig("artifacts",new SecurityConfig(),10,20,"1","someKey");
  when(goConfigService.serverConfig()).thenReturn(serverConfig);
  controller.agentRequest("host",uuid,"location","233232","osx","someKey","","",request,response);
  verify(agentService).requestRegistration(AgentRuntimeInfo.fromServer(new AgentConfig(uuid,"host",request.getRemoteAddr()),false,"location",233232L,"osx"));
  verify(goConfigService).updateConfig(any(UpdateConfigCommand.class));
}
