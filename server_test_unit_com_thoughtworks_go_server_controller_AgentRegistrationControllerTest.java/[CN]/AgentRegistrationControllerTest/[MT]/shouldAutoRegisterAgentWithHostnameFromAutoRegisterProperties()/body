{
  String uuid="uuid";
  when(goConfigService.hasAgent(uuid)).thenReturn(false);
  ServerConfig serverConfig=new ServerConfig("artifacts",new SecurityConfig(),10,20,"1","someKey");
  when(goConfigService.serverConfig()).thenReturn(serverConfig);
  controller.agentRequest("host",uuid,"location","233232","osx","someKey","","","autoregister-hostname","","",false,request);
  verify(agentService).requestRegistration(AgentRuntimeInfo.fromServer(new AgentConfig(uuid,"autoregister-hostname",request.getRemoteAddr()),false,"location",233232L,"osx",false));
  verify(agentConfigService).updateAgent(any(UpdateConfigCommand.class),eq(uuid),any(HttpOperationResult.class),eq(Username.ANONYMOUS));
}
