{
  GoFileConfigDataSource goFileConfigDataSource=mock(GoFileConfigDataSource.class);
  UpdateConfigCommand updateConfigCommand=mock(UpdateConfigCommand.class);
  CruiseConfig currentConfig=GoConfigMother.configWithPipelines("p1");
  GoFileConfigDataSource.GoConfigSaveResult goConfigSaveResult=new GoFileConfigDataSource.GoConfigSaveResult(new GoConfigHolder(currentConfig,currentConfig),ConfigSaveState.UPDATED);
  when(goFileConfigDataSource.writeWithLock(argThat(is(updateConfigCommand)),any(GoConfigHolder.class))).thenReturn(goConfigSaveResult);
  cachedFileGoConfig=new CachedFileGoConfig(goFileConfigDataSource,serverHealthService);
  ConfigSaveState configSaveState=cachedFileGoConfig.writeWithLock(updateConfigCommand);
  assertThat(configSaveState,is(ConfigSaveState.UPDATED));
}
