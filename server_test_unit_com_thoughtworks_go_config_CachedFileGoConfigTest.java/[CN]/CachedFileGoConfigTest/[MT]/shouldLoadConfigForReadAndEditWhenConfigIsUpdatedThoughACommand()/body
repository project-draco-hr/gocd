{
  cachedFileGoConfig.onTimer();
  GoConfigValidity configValidity=cachedFileGoConfig.checkConfigFileValid();
  assertThat(configValidity.isValid(),is(true));
  cachedFileGoConfig.writeWithLock(new UpdateConfigCommand(){
    public CruiseConfig update(    CruiseConfig cruiseConfig) throws Exception {
      addPipelineWithParams(cruiseConfig);
      return cruiseConfig;
    }
  }
);
  PipelineConfig reloadedPipelineConfig=cachedFileGoConfig.currentConfig().pipelineConfigByName(new CaseInsensitiveString("mingle"));
  HgMaterialConfig hgMaterialConfig=(HgMaterialConfig)byFolder(reloadedPipelineConfig.materialConfigs(),"folder");
  assertThat(hgMaterialConfig.getUrl(),is("http://hg-server/repo-name"));
  reloadedPipelineConfig=cachedFileGoConfig.loadForEditing().pipelineConfigByName(new CaseInsensitiveString("mingle"));
  hgMaterialConfig=(HgMaterialConfig)byFolder(reloadedPipelineConfig.materialConfigs(),"folder");
  assertThat(hgMaterialConfig.getUrl(),is("http://#{foo}/#{bar}"));
}
