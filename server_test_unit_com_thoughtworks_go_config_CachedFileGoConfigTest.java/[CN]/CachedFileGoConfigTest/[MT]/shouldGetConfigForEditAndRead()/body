{
  CruiseConfig cruiseConfig=configHelper.load();
  addPipelineWithParams(cruiseConfig);
  configHelper.writeConfigFile(cruiseConfig);
  cachedFileGoConfig=new CachedFileGoConfig(dataSource,new ServerHealthService());
  dataSource.reloadIfModified();
  cachedFileGoConfig.onTimer();
  PipelineConfig config=cachedFileGoConfig.currentConfig().pipelineConfigByName(new CaseInsensitiveString("mingle"));
  HgMaterialConfig hgMaterialConfig=(HgMaterialConfig)byFolder(config.materialConfigs(),"folder");
  assertThat(hgMaterialConfig.getUrl(),is("http://hg-server/repo-name"));
  config=cachedFileGoConfig.loadForEditing().pipelineConfigByName(new CaseInsensitiveString("mingle"));
  hgMaterialConfig=(HgMaterialConfig)byFolder(config.materialConfigs(),"folder");
  assertThat(hgMaterialConfig.getUrl(),is("http://#{foo}/#{bar}"));
  cachedFileGoConfig.loadConfigHolder();
}
