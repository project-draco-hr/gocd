{
  configTestRepo.addCodeToRepositoryAndPush(fileName,"added broken config file","bad bad config");
  materialUpdateService.updateMaterial(material);
  waitForMaterialNotInProgress();
  assertThat(goRepoConfigDataSource.latestParseHasFailedForMaterial(material.config()),is(true));
  final HashMap<String,String> revisions=new HashMap<String,String>();
  final HashMap<String,String> environmentVariables=new HashMap<String,String>();
  buildCauseProducer.manualProduceBuildCauseAndSave(PIPELINE_NAME,Username.ANONYMOUS,new ScheduleOptions(revisions,environmentVariables,new HashMap<String,String>()),new ServerHealthStateOperationResult());
  scheduleHelper.waitForNotScheduled(5,PIPELINE_NAME);
}
