{
  String configFileContent="test";
  String message="Invalid Config file";
  String latestContent="content";
  String latestMd5="latest-md5";
  String oldMd5="old-md5";
  GoConfigService.XmlPartialSaver partialSaver=mock(GoConfigService.XmlPartialSaver.class);
  when(mockGoConfigService.fileSaver(false)).thenReturn(partialSaver);
  when(partialSaver.saveXml(configFileContent,oldMd5)).thenReturn(GoConfigValidity.valid());
  when(partialSaver.asXml()).thenReturn(latestContent);
  when(partialSaver.getMd5()).thenReturn(latestMd5);
  ModelAndView modelAndView=controller.handleEditConfiguration(configFileContent,oldMd5,null,request);
  verify(partialSaver).saveXml(configFileContent,oldMd5);
  assertThat(modelAndView.getModelMap().get("editing_md5"),is(nullValue()));
  assertThat(modelAndView.getModelMap().get("editing_content"),is(nullValue()));
}
