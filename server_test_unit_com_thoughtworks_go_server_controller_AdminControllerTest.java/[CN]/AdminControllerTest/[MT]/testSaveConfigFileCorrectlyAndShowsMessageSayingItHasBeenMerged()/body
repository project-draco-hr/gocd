{
  String configFileContent="test";
  GoConfigService.XmlPartialSaver partialSaver=mock(GoConfigService.XmlPartialSaver.class);
  when(mockGoConfigService.fileSaver(false)).thenReturn(partialSaver);
  when(partialSaver.saveXml(configFileContent,"md5")).thenReturn(GoConfigValidity.valid(ConfigSaveState.MERGED));
  when(localizer.localize("SAVED_CONFIGURATION_SUCCESSFULLY",new Object[]{})).thenReturn("Saved configuration successfully.");
  when(localizer.localize("CONFIG_MERGED",new Object[]{})).thenReturn("The configuration was modified by someone else, but your changes were merged successfully.");
  ModelAndView modelAndView=controller.handleEditConfiguration(configFileContent,"md5",false,request);
  verify(partialSaver).saveXml(configFileContent,"md5");
  assertThat((String)modelAndView.getModelMap().get(GoConstants.SUCCESS_MESSAGE),is("Saved configuration successfully. The configuration was modified by someone else, but your changes were merged successfully."));
}
