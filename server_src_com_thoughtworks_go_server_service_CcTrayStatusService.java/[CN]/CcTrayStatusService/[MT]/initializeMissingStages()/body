{
  if (stageIdentifiers == null) {
    stageIdentifiers=stageService.findLatestStageInstances();
  }
  CruiseConfig config=goConfigService.currentCruiseConfig();
  config.accept(new PiplineConfigVisitor(){
    public void visit(    PipelineConfig pipelineConfig){
      for (      StageConfig stageConfig : pipelineConfig) {
        String stageProjectName=projectName(pipelineConfig.name().toString(),stageConfig.name().toString());
        if (!ccTrayStatus.containsProject(stageProjectName) && !ccTrayStatus.hasNoActivityFor(stageProjectName)) {
          Long stageId=find(pipelineConfig,stageConfig);
          Stage stage=stageId == null ? NullStage.createNullStage(stageConfig) : stageService.stageById(stageId);
          ccTrayStatus.updateStatusFor(stageProjectName,stage);
        }
      }
    }
  }
);
}
