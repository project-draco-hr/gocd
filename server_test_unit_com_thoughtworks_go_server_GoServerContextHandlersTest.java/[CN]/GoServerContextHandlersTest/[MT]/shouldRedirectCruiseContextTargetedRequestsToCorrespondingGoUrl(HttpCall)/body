{
  HandlerWrapper legacyHandler=(HandlerWrapper)new GoServer(new SystemEnvironment(),new GoCipherSuite(sslSocketFactory),mock(GoWebXmlConfiguration.class)).legacyRequestHandler();
  HttpServletResponse response=mock(HttpServletResponse.class);
  ByteArrayOutputStream output=new ByteArrayOutputStream();
  when(response.getWriter()).thenReturn(new PrintWriter(output));
  HttpServletRequest request=mock(HttpServletRequest.class);
  when(request.getMethod()).thenReturn(httpCall.method);
  Handler movedContextHandler=legacyHandler.getHandler();
  movedContextHandler.setServer(mock(Server.class));
  movedContextHandler.start();
  String target="/cruise" + httpCall.url;
  Request baseRequest=mock(Request.class);
  when(request.getPathInfo()).thenReturn(target);
  legacyHandler.handle(target,baseRequest,request,response);
  String responseBody=new String(output.toByteArray());
  assertThat(responseBody,is("Url(s) starting in '/cruise' have been permanently moved to '/go', please use the new path."));
  verify(response).setStatus(httpCall.expectedResponse);
  if (httpCall.shouldRedirect) {
    verify(response).setHeader("Location","/go" + httpCall.url);
  }
  verify(response).setHeader(HttpHeader.CONTENT_TYPE.asString(),"text/plain");
  verify(response).getWriter();
  verifyNoMoreInteractions(response);
}
