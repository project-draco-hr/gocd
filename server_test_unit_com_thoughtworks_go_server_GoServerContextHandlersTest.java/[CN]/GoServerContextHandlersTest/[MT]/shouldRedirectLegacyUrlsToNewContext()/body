{
  MovedContextHandler movedContextHandler=mock(MovedContextHandler.class);
  GoServer.LegacyUrlRequestHandler handler=new GoServer.LegacyUrlRequestHandler(movedContextHandler);
  HttpServletResponse response=mock(HttpServletResponse.class);
  ByteArrayOutputStream output=new ByteArrayOutputStream();
  when(response.getWriter()).thenReturn(new PrintWriter(output));
  HttpServletRequest request=mock(HttpServletRequest.class);
  when(request.getMethod()).thenReturn(HttpMethod.GET.asString());
  String target="/cruise/foo/bar?baz=quux";
  Request baseRequest=mock(Request.class);
  handler.handle(target,baseRequest,request,response);
  String responseBody=new String(output.toByteArray());
  assertThat(responseBody,is("Url(s) starting in '/cruise' have been permanently moved to '/go', please use the new path."));
  verify(movedContextHandler).handle(target,baseRequest,request,response);
  verify(response).setHeader(HttpHeaders.CONTENT_TYPE,"text/plain");
  verify(response).setHeader(HttpHeaders.CONTENT_LENGTH,"91");
  verify(response).getWriter();
  verifyNoMoreInteractions(response);
}
