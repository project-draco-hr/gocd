{
  when(provider.createSender(new MailHost("smtp.company.com",25,"smtpuser","password",true,true,"cruise@me.com","jez@me.com"))).thenReturn(sender);
  when(sender.send(any(String.class),any(String.class),eq("jez@me.com"))).thenReturn(ValidationBean.valid());
  ModelAndView json=controller.sendTestEmailToAdministrator("smtp.company.com","25","smtpuser","password",true,"cruise@me.com","jez@me.com",new MockHttpServletResponse());
  Map map=json.getModel();
  JsonMap jsonMap=(JsonMap)map.get("json");
  assertThat(jsonMap.get("isValid").toString(),is("\"true\""));
  verify(provider).createSender(new MailHost("smtp.company.com",25,"smtpuser","password",true,true,"cruise@me.com","jez@me.com"));
  verify(sender).send(any(String.class),any(String.class),eq("jez@me.com"));
}
