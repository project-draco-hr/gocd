{
  AgentConfig agentConfig=AgentMother.remoteAgent();
  configHelper.addAgent(agentConfig);
  fixture.createPipelineWithFirstStageScheduled();
  AgentRuntimeInfo info=AgentRuntimeInfo.fromServer(agentConfig,true,"location",1000000l,"OS");
  info.setCookie("cookie");
  AgentStatus[] statuses=new AgentStatus[]{AgentStatus.Building,AgentStatus.Pending,AgentStatus.Disabled,AgentStatus.Disabled,AgentStatus.LostContact,AgentStatus.Missing};
  for (  AgentStatus status : statuses) {
    info.setStatus(status);
    final List<Message> messages=new ArrayList<>();
    Agent agent=createWebsocketAgent(messages);
    agentRemoteHandler.process(agent,new Message(Action.ping,info));
    buildAssignmentService.onTimer();
    assertThat("Should not assign work when agent status is " + status,messages.size(),is(0));
  }
}
