{
  fixture.createPipelineWithFirstStageScheduled();
  buildAssignmentService.onTimer();
  configHelper.removeStage(fixture.pipelineName,fixture.devStage);
  buildAssignmentService.onPipelineConfigChange(goConfigService.getCurrentConfig().getPipelineConfigByName(new CaseInsensitiveString(fixture.pipelineName)),"g1");
  Pipeline pipeline=pipelineDao.mostRecentPipeline(fixture.pipelineName);
  JobInstance job=pipeline.getFirstStage().getJobInstances().first();
  assertThat(job.getState(),is(JobState.Completed));
  assertThat(job.getResult(),is(JobResult.Cancelled));
}
