{
  NotificationPluginRegistry.getInstance().registerPluginInterests(PLUGIN_ID_1,Arrays.asList(new String[]{PIPELINE_STATUS}));
  Result result=new Result();
  result.withErrorMessages(Arrays.asList(new String[]{"message 1","message 2"}));
  when(notificationExtension.notify(PLUGIN_ID_1,PIPELINE_STATUS,REQUEST_BODY)).thenReturn(result);
  when(serverHealthService.update(serverHealthState.capture())).thenReturn(null);
  PluginNotificationService pluginNotificationService=new PluginNotificationService(notificationExtension,serverHealthService);
  pluginNotificationService.notifyPlugins(new PluginNotificationMessage(PIPELINE_STATUS,REQUEST_BODY));
  verify(notificationExtension).notify(PLUGIN_ID_1,PIPELINE_STATUS,REQUEST_BODY);
  assertThat(serverHealthState.getValue().getMessage(),is("Notification update failed for plugin: plugin-id-1"));
  assertThat(serverHealthState.getValue().getDescription(),is("message 1, message 2"));
  verify(serverHealthService,never()).removeByScope(any(HealthStateScope.class));
}
