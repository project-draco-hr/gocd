{
  List<PipelineConfig> pipelineConfigList=currentPipeline.allFirstLevelUpstreamPipelines(cruiseConfig);
  if (!pipelineConfigList.contains(cruiseConfig.pipelineConfigByName(pipelineName.getAncestorName()))) {
    addError(PIPELINE_NAME,String.format("Pipeline \"%s\" tries to fetch artifact from pipeline " + "\"%s\" which is not an upstream pipeline",currentPipeline.name(),pipelineName));
    return;
  }
  PipelineConfig pipelineConfig=cruiseConfig.pipelineConfigByName(pipelineName.getAncestorName());
  List<StageConfig> validStages=pipelineConfig.validStagesForFetchArtifact(currentPipeline,validationContext.getStage().name());
  if (!validStages.contains(cruiseConfig.stageConfigByName(pipelineName.getAncestorName(),stage))) {
    addStageMayNotCompleteBeforeDownstreamError(currentPipeline);
  }
}
