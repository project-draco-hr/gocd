{
  GitSubmoduleRepos submoduleRepos=new GitSubmoduleRepos();
  File submoduleFolder=submoduleRepos.addSubmodule(SUBMODULE,"sub1");
  GitCommand gitWithSubmodule=new GitCommand(null,createTempWorkingDirectory(),GitMaterialConfig.DEFAULT_BRANCH,false);
  gitWithSubmodule.cloneFrom(inMemoryConsumer(),submoduleRepos.mainRepo().getUrl());
  FileUtils.deleteDirectory(submoduleFolder);
  assertThat(submoduleFolder.exists(),is(false));
  try {
    gitWithSubmodule.fetchAndReset(new SysOutStreamConsumer(),new StringRevision("HEAD"));
    fail("should have failed for non 0 return code");
  }
 catch (  Exception e) {
    assertThat(e.getMessage(),containsString(String.format("Clone of '%s' into submodule path 'sub1' failed",submoduleFolder.getAbsolutePath())));
  }
}
