{
switch (msg.getAction()) {
case ping:
    AgentRuntimeInfo info=(AgentRuntimeInfo)msg.getData();
  this.agentSessions.put(info.getUUId(),agent);
if (info.getCookie() == null) {
  String cookie=buildRepositoryRemote.getCookie(info.getIdentifier(),info.getLocation());
  info.setCookie(cookie);
  agent.send(new Message(Action.setCookie,cookie));
}
AgentInstruction instruction=this.buildRepositoryRemote.ping(info);
if (instruction.isShouldCancelJob()) {
agent.send(new Message(Action.cancelJob,instruction));
}
break;
case reportCurrentStatus:
Report report=(Report)msg.getData();
buildRepositoryRemote.reportCurrentStatus(report.getAgentRuntimeInfo(),report.getJobIdentifier(),report.getJobState());
break;
case reportCompleting:
report=(Report)msg.getData();
buildRepositoryRemote.reportCompleting(report.getAgentRuntimeInfo(),report.getJobIdentifier(),report.getResult());
break;
case reportCompleted:
report=(Report)msg.getData();
buildRepositoryRemote.reportCompleted(report.getAgentRuntimeInfo(),report.getJobIdentifier(),report.getResult());
break;
default :
throw new RuntimeException("Unknown action: " + msg.getAction());
}
}
