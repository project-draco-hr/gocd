{
  if (action instanceof Ping) {
    AgentRuntimeInfo info=(AgentRuntimeInfo)action.data();
    this.agentSessions.put(info.getUUId(),agent);
    if (info.getCookie() == null) {
      String cookie=buildRepositoryRemote.getCookie(info.getIdentifier(),info.getLocation());
      info.setCookie(cookie);
      if (!agent.send(new SetCookie(cookie))) {
        return;
      }
    }
    AgentInstruction instruction=this.buildRepositoryRemote.ping(info);
    if (instruction.isShouldCancelJob()) {
      agent.send(new CancelJob());
    }
  }
 else {
    throw new RuntimeException("Unknown action: " + action);
  }
}
