{
  File workingDir=new File(CruiseConfig.WORKING_BASE_DIR + "pipelineName");
  MaterialRevisions revisions=ModificationsMother.modifyOneFile(MaterialsMother.defaultMaterials(),ModificationsMother.nextRevision());
  BuildCause buildCause=BuildCause.createWithModifications(revisions,"");
  List<Builder> builder=new ArrayList<Builder>();
  builder.add(new CommandBuilder("command","args",workingDir,new RunIfConfigs(),new NullBuilder(),"desc"));
  BuildAssignment assignment=BuildAssignment.create(jobPlan(),buildCause,builder,workingDir);
  BuildWork work=new BuildWork(assignment);
  String msg=Message.encode(new Message(Action.assignWork,work));
  Message decodedMsg=Message.decode(msg);
  assertThat(((BuildWork)decodedMsg.getData()).getAssignment().getPlan().getPipelineName(),is("pipelineName"));
}
