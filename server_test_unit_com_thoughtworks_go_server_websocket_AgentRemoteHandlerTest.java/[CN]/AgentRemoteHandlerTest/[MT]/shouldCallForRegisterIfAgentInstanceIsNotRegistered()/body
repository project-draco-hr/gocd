{
  AgentRuntimeInfo info=AgentRuntimeInfo.fromAgent(new AgentIdentifier("HostName","ipAddress","uuid"));
  info.setCookie("cookie");
  info.setStatus(AgentStatus.Pending);
  AgentInstance agentInstance=AgentInstance.createFromLiveAgent(info,new SystemEnvironment());
  when(agentService.findAgent("uuid")).thenReturn(agentInstance);
  handler.process(this,new Message(Action.ping,info));
  assertEquals(0,handler.connectedAgents().size());
  assertEquals(1,messages.size());
  assertEquals(Action.reregister,messages.get(0).getAction());
}
