{
  CcTrayStatus status=new CcTrayStatus(materialRepo,stageDao);
  JobInstance passedJob=passedJob("go",DEFAULT_LAST_BUILD_LABEL,"dev","linux-firefox");
  JobInstance failedJob=failedJob("go",DEFAULT_LAST_BUILD_LABEL,"dev","win-firefox");
  passedJob.setStageId(1L);
  failedJob.setStageId(1L);
  Stage failedStage=new Stage("dev",new JobInstances(passedJob,failedJob),"me","success",false,false,new TimeProvider());
  failedStage.setPipelineId(12l);
  failedStage.calculateResult();
  when(stageDao.stageById(1L)).thenReturn(failedStage);
  Modification losersOtherCommit=ModificationsMother.checkinWithComment("125","comment 3","loser","loser@different-email.com",new Date(),"baz.c");
  MaterialRevision revision=new MaterialRevision(MaterialsMother.gitMaterial("foo.com"),losersOtherCommit);
  revision.markAsChanged();
  when(materialRepo.findMaterialRevisionsForPipeline(12l)).thenReturn(new MaterialRevisions(revision));
  status.jobStatusChanged(passedJob);
  HashSet<String> breakers=new HashSet<String>();
  assertThat(status.projects().size(),is(1));
  assertThat((HashSet<String>)((ProjectStatus)(status.projects().toArray()[0])).getBreakers(),is(breakers));
}
