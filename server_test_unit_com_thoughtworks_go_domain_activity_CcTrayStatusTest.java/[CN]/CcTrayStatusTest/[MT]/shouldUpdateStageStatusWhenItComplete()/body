{
  CcTrayStatus status=new CcTrayStatus(materialRepo,stageDao);
  Stage stage=scheduleStage("cruise","label","dev","linux-firefox");
  JobInstance job=stage.getJobInstances().first();
  status.stageStatusChanged(stage);
  assertThat(status.projects().size(),is(2));
  assertThat(status.projects(),hasItem(new ProjectStatus("cruise :: dev","Building",DEFAULT_LAST_BUILD_STATUS,DEFAULT_LAST_BUILD_LABEL,DEFAULT_LAST_BUILD_TIME,stage.getIdentifier().webUrl())));
  assertThat(status.projects(),hasItem(new ProjectStatus("cruise :: dev :: linux-firefox","Building",DEFAULT_LAST_BUILD_STATUS,DEFAULT_LAST_BUILD_LABEL,DEFAULT_LAST_BUILD_TIME,job.getIdentifier().webUrl())));
  stage=failedStage("cruise","label","dev","1","linux-firefox");
  job=stage.getJobInstances().first();
  status.stageStatusChanged(stage);
  assertThat(status.projects().size(),is(2));
  assertThat(status.projects(),hasItem(projectStatusForFailedStage(stage)));
  assertThat(status.projects(),hasItem(projectStatusForFailedJob(job)));
}
