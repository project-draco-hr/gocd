{
  HttpLocalizedOperationResult result=new HttpLocalizedOperationResult();
  Username user=new Username(new CaseInsensitiveString("user"));
  when(securityService.isUserAdmin(user)).thenReturn(true);
  String environmentName="foo-environment";
  when(mockGoConfigService.hasEnvironmentNamed(new CaseInsensitiveString(environmentName))).thenReturn(true);
  environmentConfigService.createEnvironment(env(environmentName,new ArrayList<String>(),new ArrayList<Map<String,String>>(),new ArrayList<String>()),user,result);
  assertThat(result.isSuccessful(),is(false));
  assertThat(result.httpCode(),is(HttpServletResponse.SC_CONFLICT));
  Localizer localizer=mock(Localizer.class);
  result.message(localizer);
  verify(localizer).localize("CANNOT_ADD_ENV_ALREADY_EXISTS",new CaseInsensitiveString(environmentName));
  verify(mockGoConfigService).hasEnvironmentNamed(new CaseInsensitiveString(environmentName));
  verifyNoMoreInteractions(mockGoConfigService);
}
