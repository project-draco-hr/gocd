{
  RubyClass klass=info.generatorStateClass.get();
  if (opts != null) {
    if (klass.isInstance(opts))     return (GeneratorState)opts;
    if (context.getRuntime().getHash().isInstance(opts)) {
      return (GeneratorState)klass.newInstance(context,new IRubyObject[]{opts},Block.NULL_BLOCK);
    }
  }
  return (GeneratorState)info.getSafeStatePrototype(context).dup();
}
