{
  long end=System.currentTimeMillis() + timeout.inMillis();
  Exception e=null;
  while (true) {
    T answer;
    try {
      if ((answer=func.call()) != null) {
        return answer;
      }
    }
 catch (    Exception caught) {
      e=caught;
    }
    boolean timedout=System.currentTimeMillis() > end;
    if (timedout) {
      break;
    }
 else {
      sleepOneSec();
    }
  }
  String msg=e == null ? "wait timed out after " + timeout + " for: "+ func.toString() : e.getMessage();
  throw new RuntimeException(msg,e);
}
