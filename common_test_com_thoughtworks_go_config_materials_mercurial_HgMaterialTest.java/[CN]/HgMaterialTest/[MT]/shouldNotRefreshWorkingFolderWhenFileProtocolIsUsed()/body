{
  new HgCommand(null,workingFolder,"default",hgTestRepo.url().forCommandline()).clone(inMemoryConsumer(),hgTestRepo.url());
  File testFile=createNewFileInWorkingFolder();
  hgMaterial=MaterialsMother.hgMaterial("file://" + hgTestRepo.projectRepositoryUrl());
  hgMaterial.updateTo(outputStreamConsumer,new StringRevision("0"),workingFolder,new TestSubprocessExecutionContext());
  String workingUrl=new HgCommand(null,workingFolder,"default",hgTestRepo.url().forCommandline()).workingRepositoryUrl().outputAsString();
  assertThat(workingUrl,is(hgTestRepo.projectRepositoryUrl()));
  assertThat(testFile.exists(),is(true));
}
