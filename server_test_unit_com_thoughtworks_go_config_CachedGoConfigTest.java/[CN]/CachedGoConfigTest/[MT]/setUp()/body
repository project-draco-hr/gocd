{
  configHelper=new GoConfigFileHelper(ONE_CONFIG_REPO);
  SystemEnvironment env=new SystemEnvironment();
  ConfigRepository configRepository=new ConfigRepository(env);
  configRepository.initialize();
  dataSource=new GoFileConfigDataSource(new DoNotUpgrade(),configRepository,env,new TimeProvider(),new ConfigCache(),new ServerVersion(),ConfigElementImplementationRegistryMother.withNoPlugins(),metricsProbeService,serverHealthService);
  serverHealthService=new ServerHealthService();
  cachedFileGoConfig=new CachedFileGoConfig(dataSource,serverHealthService);
  cachedFileGoConfig.loadConfigIfNull();
  configPluginService=mock(GoConfigPluginService.class);
  plugin=mock(PartialConfigProvider.class);
  when(configPluginService.partialConfigProviderFor(any(ConfigRepoConfig.class))).thenReturn(plugin);
  configWatchList=new GoConfigWatchList(cachedFileGoConfig);
  checkoutService=mock(ScmMaterialCheckoutService.class);
  repoConfigDataSource=new GoRepoConfigDataSource(configWatchList,configPluginService,checkoutService);
  partials=new GoPartialConfig(repoConfigDataSource,configWatchList);
  cachedGoConfig=new CachedGoConfig(serverHealthService,cachedFileGoConfig,partials);
}
