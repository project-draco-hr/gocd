{
  GoConfigDataSource goConfigDataSource=mock(GoConfigDataSource.class);
  UpdateConfigCommand updateConfigCommand=mock(UpdateConfigCommand.class);
  CruiseConfig currentConfig=GoConfigMother.configWithPipelines("p1");
  GoConfigDataSource.GoConfigSaveResult goConfigSaveResult=new GoConfigDataSource.GoConfigSaveResult(new GoConfigHolder(currentConfig,currentConfig),ConfigSaveState.UPDATED);
  when(goConfigDataSource.writeWithLock(argThat(is(updateConfigCommand)),any(GoConfigHolder.class))).thenReturn(goConfigSaveResult);
  cachedGoConfig=new CachedGoConfig(goConfigDataSource,serverHealthService);
  ConfigSaveState configSaveState=cachedGoConfig.writeWithLock(updateConfigCommand);
  assertThat(configSaveState,is(ConfigSaveState.UPDATED));
}
