{
  if (hasTemplate()) {
    if (new NameTypeValidator().isNameInvalid(templateName.toString())) {
      errors().add(TEMPLATE_NAME,NameTypeValidator.errorMessage("template",templateName));
    }
    if (hasStages() && !hasTemplateApplied()) {
      addError("stages",String.format("Cannot add stages to pipeline '%s' which already references template '%s'",this.name(),this.getTemplateName()));
      addError("template",String.format("Cannot set template '%s' on pipeline '%s' because it already has stages defined",this.getTemplateName(),this.name()));
    }
    if (!validationContext.doesTemplateExist(templateName)) {
      addError("pipeline",String.format("Pipeline '%s' refers to non-existent template '%s'.",name(),templateName));
    }
  }
 else {
    if (isEmpty()) {
      addError("pipeline",String.format("Pipeline '%s' does not have any stages configured. A pipeline must have at least one stage.",name()));
    }
  }
}
