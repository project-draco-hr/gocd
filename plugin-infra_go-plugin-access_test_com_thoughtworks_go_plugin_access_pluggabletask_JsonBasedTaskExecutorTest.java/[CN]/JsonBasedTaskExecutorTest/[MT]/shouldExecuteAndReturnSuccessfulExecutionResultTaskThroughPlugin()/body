{
  TaskExecutionContext context=mock(TaskExecutionContext.class);
  PluginManager pluginManager=mock(PluginManager.class);
  String pluginId="pluginId";
  GoPluginApiResponse response=mock(GoPluginApiResponse.class);
  when(pluginManager.submitTo(eq(pluginId),any(GoPluginApiRequest.class))).thenReturn(response);
  when(response.responseBody()).thenReturn("{\"success\":true,\"messages\":[\"message1\",\"message2\"]}");
  final JsonBasedTaskExtensionHandler_V1 handler=new JsonBasedTaskExtensionHandler_V1();
  ExecutionResult result=new JsonBasedTaskExecutor(pluginId,pluginManager,handler).execute(config(),context);
  assertThat(result.isSuccessful(),is(true));
  assertThat(result.getMessagesForDisplay(),is("message1\nmessage2"));
  ArgumentCaptor<GoPluginApiRequest> argument=ArgumentCaptor.forClass(GoPluginApiRequest.class);
  verify(pluginManager).submitTo(eq(pluginId),argument.capture());
  assertThat(argument.getValue().extension(),is(JsonBasedTaskExtension.TASK_EXTENSION));
  assertThat(argument.getValue().extensionVersion(),is(handler.version()));
  assertThat(argument.getValue().requestName(),is(JsonBasedTaskExtension.EXECUTION_REQUEST));
}
