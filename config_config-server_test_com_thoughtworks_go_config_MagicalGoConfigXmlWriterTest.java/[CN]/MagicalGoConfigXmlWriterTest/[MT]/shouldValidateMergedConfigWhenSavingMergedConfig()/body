{
  String xml=ConfigFileFixture.TWO_PIPELINES;
  CruiseConfig cruiseConfig=ConfigMigrator.loadWithMigration(IOUtils.toInputStream(xml)).config;
  PartialConfig remotePart=PartialConfigMother.withPipelineInGroup("pipeline1","defaultGroup");
  remotePart.setOrigin(new RepoConfigOrigin());
  BasicCruiseConfig merged=new BasicCruiseConfig((BasicCruiseConfig)cruiseConfig,remotePart);
  List<ConfigErrors> errors=merged.validateAfterPreprocess();
  assertThat(errors.size(),is(2));
  try {
    xmlWriter.write(merged,output,false);
    fail("Should not be able to save config when there are errors in merged config");
  }
 catch (  Exception e) {
    assertThat(e.getMessage(),containsString("You have defined multiple pipelines named 'pipeline1'. Pipeline names must be unique."));
  }
}
