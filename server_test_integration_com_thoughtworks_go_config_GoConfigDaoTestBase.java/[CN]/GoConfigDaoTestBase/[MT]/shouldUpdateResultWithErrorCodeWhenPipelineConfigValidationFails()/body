{
  Username username=new Username(new CaseInsensitiveString("user"));
  PipelineConfig pipelineConfig=mock(PipelineConfig.class);
  LocalizedOperationResult result=mock(LocalizedOperationResult.class);
  PipelineConfigService.SaveCommand saveCommand=mock(PipelineConfigService.SaveCommand.class);
  when(saveCommand.hasWritePermissions()).thenReturn(true);
  CachedGoConfig cachedConfigService=mock(CachedGoConfig.class);
  doThrow(new ConfigUpdateCheckFailedException()).when(cachedConfigService).writePipelineWithLock(pipelineConfig,saveCommand,username);
  goConfigDao=new GoConfigDao(cachedConfigService,null,new GoConfigWriteLock());
  goConfigDao.updatePipeline(pipelineConfig,result,username,saveCommand);
  verify(result).unprocessableEntity(Matchers.<Localizable>any());
}
