{
  CachedGoConfig cachedConfigService=mock(CachedGoConfig.class);
  Username username=new Username(new CaseInsensitiveString("user"));
  CruiseConfig cruiseConfig=mock(CruiseConfig.class);
  EntityConfigUpdateCommand saveCommand=mock(EntityConfigUpdateCommand.class);
  when(saveCommand.canContinue(cruiseConfig)).thenReturn(true);
  CachedGoConfig cachedGoConfig=mock(CachedGoConfig.class);
  doThrow(new ConfigUpdateCheckFailedException()).when(cachedGoConfig).writeEntityWithLock(saveCommand,username);
  goConfigDao=new GoConfigDao(cachedGoConfig);
  goConfigDao.updateConfig(saveCommand,username);
  goConfigDao=new GoConfigDao(cachedConfigService);
  Username currentUser=new Username(new CaseInsensitiveString("user"));
  goConfigDao.updateConfig(saveCommand,currentUser);
  verify(cachedConfigService).writeEntityWithLock(saveCommand,currentUser);
}
