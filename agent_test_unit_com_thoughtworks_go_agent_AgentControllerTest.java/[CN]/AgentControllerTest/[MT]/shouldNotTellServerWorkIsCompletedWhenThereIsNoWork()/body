{
  when(loopServer.getWork(any(AgentRuntimeInfo.class))).thenReturn(work);
  when(agentRegistry.uuid()).thenReturn(agentUuid);
  agentController=createAgentController();
  agentController.init();
  agentController.retrieveWork();
  verify(work).doWork(eq(agentIdentifier),eq(loopServer),eq(artifactsManipulator),any(EnvironmentVariableContext.class),any(AgentRuntimeInfo.class),eq(packageAsRepositoryExtension),eq(scmExtension),eq(taskExtension));
  verify(sslInfrastructureService).createSslInfrastructure();
}
