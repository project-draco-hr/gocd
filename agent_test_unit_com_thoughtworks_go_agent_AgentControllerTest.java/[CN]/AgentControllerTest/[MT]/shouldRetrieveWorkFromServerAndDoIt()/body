{
  when(loopServer.getWork(any(AgentRuntimeInfo.class))).thenReturn(work);
  when(agentRegistry.uuid()).thenReturn(agentUuid);
  agentController=new AgentController(loopServer,artifactsManipulator,sslInfrastructureService,agentRegistry,agentUpgradeService,subprocessLogger,systemEnvironment,pluginManager,taskExtension);
  agentController.init();
  agentController.ping();
  agentController.retrieveWork();
  verify(work).doWork(eq(agentIdentifier),eq(loopServer),eq(artifactsManipulator),any(EnvironmentVariableContext.class),any(AgentRuntimeInfo.class),eq(taskExtension));
  verify(sslInfrastructureService).createSslInfrastructure();
}
