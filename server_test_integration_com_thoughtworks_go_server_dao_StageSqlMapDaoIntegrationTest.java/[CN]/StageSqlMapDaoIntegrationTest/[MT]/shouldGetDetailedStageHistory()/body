{
  HgMaterial hg=new HgMaterial("url",null);
  String[] hg_revs={"h1","h2","h3"};
  scheduleUtil.checkinInOrder(hg,hg_revs);
  String pipelineName="p1";
  String stageName="stage_name";
  ScheduleTestUtil.AddedPipeline p1=scheduleUtil.saveConfigWith(pipelineName,stageName,scheduleUtil.m(hg),new String[]{"job1","job2"});
  scheduleUtil.runAndPass(p1,"h1");
  scheduleUtil.runAndPass(p1,"h2");
  scheduleUtil.runAndPass(p1,"h3");
  Pagination pagination=Pagination.pageStartingAt(0,3,2);
  StageInstanceModels stageInstanceModels=stageDao.findDetailedStageHistoryByOffset(pipelineName,stageName,pagination);
  assertThat(stageInstanceModels.size(),is(2));
  assertThat(stageInstanceModels.get(0).getResult(),is(StageResult.Passed));
  assertThat(stageInstanceModels.get(0).getIdentifier().getPipelineName(),is(pipelineName));
  assertThat(stageInstanceModels.get(0).getIdentifier().getPipelineCounter(),is(3));
  assertThat(stageInstanceModels.get(0).getIdentifier().getStageName(),is(stageName));
  assertThat(stageInstanceModels.get(0).getIdentifier().getStageCounter(),is("1"));
  assertJobDetails(stageInstanceModels.get(0).getBuildHistory());
  assertThat(stageInstanceModels.get(1).getResult(),is(StageResult.Passed));
  assertThat(stageInstanceModels.get(1).getIdentifier().getPipelineName(),is(pipelineName));
  assertThat(stageInstanceModels.get(1).getIdentifier().getPipelineCounter(),is(2));
  assertThat(stageInstanceModels.get(1).getIdentifier().getStageName(),is(stageName));
  assertThat(stageInstanceModels.get(1).getIdentifier().getStageCounter(),is("1"));
  assertJobDetails(stageInstanceModels.get(1).getBuildHistory());
  pagination=Pagination.pageStartingAt(2,3,2);
  stageInstanceModels=stageDao.findDetailedStageHistoryByOffset(pipelineName,stageName,pagination);
  assertThat(stageInstanceModels.size(),is(1));
  assertThat(stageInstanceModels.get(0).getResult(),is(StageResult.Passed));
  assertThat(stageInstanceModels.get(0).getIdentifier().getPipelineName(),is(pipelineName));
  assertThat(stageInstanceModels.get(0).getIdentifier().getPipelineCounter(),is(1));
  assertThat(stageInstanceModels.get(0).getIdentifier().getStageName(),is(stageName));
  assertThat(stageInstanceModels.get(0).getIdentifier().getStageCounter(),is("1"));
  assertJobDetails(stageInstanceModels.get(0).getBuildHistory());
}
