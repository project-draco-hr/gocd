{
  configHelper.addMailHost(getMailhost("mailhost.local.old"));
  final String oldMd5=goConfigFileDao.md5OfConfigFile();
  configHelper.addMailHost(getMailhost("mailhost.local"));
  ConfigSaveState configSaveState=goConfigFileDao.updateConfig(configHelper.addPipelineCommand(oldMd5,"p2","stage1","build1"));
  CruiseConfig updatedConfig=goConfigFileDao.load();
  assertThat(updatedConfig.hasPipelineNamed(new CaseInsensitiveString("p2")),is(true));
  assertThat(updatedConfig.mailHost().getHostName(),is("mailhost.local"));
  assertThat(configSaveState,is(ConfigSaveState.MERGED));
}
