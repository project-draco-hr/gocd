{
  AgentConfig agentConfig1=new AgentConfig("uuid1","hostname","127.0.0.1");
  AgentInstance fromConfigFile1=AgentInstance.createFromConfig(agentConfig1,new SystemEnvironment());
  goConfigFileDao.addAgent(agentConfig1);
  goConfigFileDao.addAgent(new AgentConfig("uuid2","hostname","127.0.0.1"));
  BasicEnvironmentConfig env=new BasicEnvironmentConfig(new CaseInsensitiveString("foo-environment"));
  env.addAgent("uuid1");
  env.addAgent("uuid2");
  goConfigFileDao.addEnvironment(env);
  CruiseConfig cruiseConfig=goConfigFileDao.load();
  assertThat(cruiseConfig.getEnvironments().get(0).getAgents().size(),is(2));
  goConfigFileDao.deleteAgents(fromConfigFile1);
  cruiseConfig=goConfigFileDao.load();
  assertThat(cruiseConfig.getEnvironments().get(0).getAgents().size(),is(1));
  assertThat(cruiseConfig.getEnvironments().get(0).getAgents().get(0).getUuid(),is("uuid2"));
}
