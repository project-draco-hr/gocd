{
  final PackageMaterial material=MaterialsMother.packageMaterial();
  final MaterialInstance materialInstance=material.createMaterialInstance();
  materialRepository.saveOrUpdate(materialInstance);
  addMetadata(material,"fieldX",false);
  material.getPackageDefinition().getConfiguration().addNewConfiguration("fieldX",true);
  final List<Modification> modifications=ModificationsMother.multipleModificationList();
  transactionTemplate.execute(new TransactionCallback(){
    @Override public Object doInTransaction(    TransactionStatus transactionStatus){
      packageMaterialUpdater.insertLatestOrNewModifications(material,materialInstance,new File(""),new Modifications(modifications));
      return null;
    }
  }
);
  MaterialInstance actualInstance=materialRepository.findMaterialInstance(material);
  assertThat(actualInstance.getConfiguration(),is(material.createMaterialInstance().getConfiguration()));
}
