{
  UserLicenseLimitExceededException actualException=new UserLicenseLimitExceededException("exceeded");
  doThrow(actualException).when(userService).addUserIfDoesNotExist(UserHelper.getUserName(resultantAuthorization));
  try {
    enforcementProvider.authenticate(auth);
    fail("should have thrown UserLicenseLimitExceededException");
  }
 catch (  UserLicenseLimitExceededException expected) {
    assertThat(expected,sameInstance(actualException));
  }
  verify(userService).addUserIfDoesNotExist(UserHelper.getUserName(resultantAuthorization));
}
