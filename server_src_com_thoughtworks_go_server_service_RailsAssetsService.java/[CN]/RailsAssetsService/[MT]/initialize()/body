{
  if (!(systemEnvironment.get(SystemEnvironment.USE_NEW_RAILS) && systemEnvironment.useCompressedJs())) {
    return;
  }
  String assetsDirPath=servletContext.getRealPath(servletContext.getInitParameter("rails.root") + "/public/assets/");
  File assetsDir=new File(assetsDirPath);
  if (!assetsDir.exists()) {
    throw new RuntimeException(String.format("Assets directory does not exist %s",assetsDirPath));
  }
  File manifestFile=null;
  Iterator iterator=FileUtils.iterateFiles(assetsDir,new String[]{"json"},false);
  while (iterator.hasNext()) {
    File next=(File)iterator.next();
    if (MANIFEST_FILE_PATTERN.matcher(next.getName()).matches()) {
      manifestFile=next;
      break;
    }
  }
  if (manifestFile == null) {
    throw new RuntimeException(String.format("Manifest json file was not found at %s",assetsDirPath));
  }
  LOG.info(String.format("Found rails assets manifest file named %s ",manifestFile.getName()));
  String manifest=FileUtil.readContentFromFile(manifestFile);
  Gson gson=new Gson();
  railsAssetsManifest=gson.fromJson(manifest,RailsAssetsManifest.class);
  LOG.info(String.format("Successfully read rails assets manifest file located at %s",manifestFile.getAbsolutePath()));
}
