{
  MockHttpServletRequest httpRequest=new MockHttpServletRequest();
  MockHttpServletResponse httpResponse=new MockHttpServletResponse();
  BasicAuthenticationFilter filter=new BasicAuthenticationFilter();
  SecurityContext context=SecurityContextHolder.getContext();
  String expected_msg="There was an error authenticating you. Please check the server logs, or contact your the go administrator.";
  filter.handleException(httpRequest,httpResponse,new Exception("some error"));
  assertThat(((Exception)(httpRequest.getSession().getAttribute(AbstractProcessingFilter.SPRING_SECURITY_LAST_EXCEPTION_KEY))).getMessage(),is(expected_msg));
  assertThat(httpRequest.getAttribute(SessionDenialAwareAuthenticationProcessingFilterEntryPoint.SESSION_DENIED).toString(),is("true"));
  assertThat(context.getAuthentication(),is(nullValue()));
  assertThat(httpResponse.getRedirectedUrl(),is("/go/auth/login?login_error=1"));
}
