{
  Date timestamp=new Date();
  PluggableSCMMaterialRevision knownRevision=new PluggableSCMMaterialRevision("rev-122",timestamp);
  ArgumentCaptor<SCMRevision> knownSCMRevision=new ArgumentCaptor<SCMRevision>();
  SCMRevision latestRevision=new SCMRevision("rev-123",timestamp,"user",null,null,null);
  when(scmExtension.latestModificationSince(eq(material.getPluginId()),scmConfiguration.capture(),eq("/tmp/flyweight"),knownSCMRevision.capture())).thenReturn(asList(latestRevision));
  List<Modification> modifications=poller.modificationsSince(material,new File("/tmp/flyweight"),knownRevision,null);
  assertThat(modifications.get(0).getRevision(),is("rev-123"));
  assertThat(modifications.get(0).getModifiedTime(),is(timestamp));
  assertThat(modifications.get(0).getUserName(),is("user"));
  assertThat(modifications.get(0).getComment(),is(nullValue()));
  assertConfiguration(scmConfiguration.getValue(),"k1","v1");
  assertConfiguration(scmConfiguration.getValue(),"k2","v2");
  assertThat(knownSCMRevision.getValue().getRevision(),is("rev-122"));
  assertThat(knownSCMRevision.getValue().getTimestamp(),is(timestamp));
}
