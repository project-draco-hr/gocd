{
  final String pipelineName=UUID.randomUUID().toString();
  final String templateName=UUID.randomUUID().toString();
  final boolean[] listenerInvoked={false};
  setupPipelineWithTemplate(pipelineName,templateName);
  PipelineConfigChangedListener pipelineConfigChangedListener=new PipelineConfigChangedListener(){
    @Override public void onPipelineConfigChange(    PipelineConfig pipelineConfig,    String group){
      listenerInvoked[0]=true;
      assertThat(pipelineConfig.first(),is(goConfigService.cruiseConfig().getTemplateByName(new CaseInsensitiveString(templateName)).first()));
    }
    @Override public void onConfigChange(    CruiseConfig newCruiseConfig){
    }
  }
;
  goConfigService.register(pipelineConfigChangedListener);
  PipelineConfig pipeline=PipelineConfigMother.pipelineConfigWithTemplate(pipelineName,templateName);
  pipeline.setVariables(new EnvironmentVariablesConfig());
  pipelineConfigService.updatePipelineConfig(user,pipeline,new DefaultLocalizedOperationResult());
  assertThat(listenerInvoked[0],is(true));
}
