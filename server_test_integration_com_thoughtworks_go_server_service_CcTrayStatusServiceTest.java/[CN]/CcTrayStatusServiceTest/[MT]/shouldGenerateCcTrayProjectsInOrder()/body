{
  Pipeline pipeline=pipelineFixture.createdPipelineWithAllStagesPassed();
  Stage devStage=pipeline.getStages().byName(pipelineFixture.devStage);
  ccTrayStatus.stageStatusChanged(devStage);
  Stage ftStage=pipeline.getStages().byName(pipelineFixture.ftStage);
  ccTrayStatus.stageStatusChanged(ftStage);
  Document document=ccTrayStatusService.createCctrayXmlDocument("");
  List<Element> projects=XPath.selectNodes(document,format("/Projects/Project"));
  assertThat(projects.size(),is(4));
  assertThat(projects.get(0).getAttributeValue("name"),is(devStage.getIdentifier().ccProjectName()));
  assertThat(projects.get(1).getAttributeValue("name"),is(devStage.getJobInstances().first().getIdentifier().ccProjectName()));
  assertThat(projects.get(2).getAttributeValue("name"),is(ftStage.getIdentifier().ccProjectName()));
  assertThat(projects.get(3).getAttributeValue("name"),is(ftStage.getJobInstances().first().getIdentifier().ccProjectName()));
}
