{
  String pluginId="plugin-1";
  String queueName=CreateAgentQueueHandler.QUEUE_NAME_PREFIX + pluginId;
  when(elasticAgentExtension.canHandlePlugin(pluginId)).thenReturn(false);
  GoPluginDescriptor pluginDescriptor=new GoPluginDescriptor(pluginId,null,null,null,null,false);
  handler.pluginLoaded(pluginDescriptor);
  handler.pluginUnLoaded(pluginDescriptor);
  assertThat(handler.queues.containsKey(pluginId),is(false));
  assertThat(handler.listeners.containsKey(pluginId),is(false));
  assertThat(handler.listeners.get(pluginId),is(nullValue()));
  verify(messaging,never()).removeQueue(queueName);
  verify(messaging,never()).addQueueListener(any(String.class),any(GoMessageListener.class));
}
