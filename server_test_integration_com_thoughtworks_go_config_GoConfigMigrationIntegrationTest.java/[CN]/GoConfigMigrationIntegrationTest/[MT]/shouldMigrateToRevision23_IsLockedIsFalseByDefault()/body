{
  final String content="<?xml version=\"1.0\" encoding=\"UTF-8\"?>" + "<cruise schemaVersion=\"22\">\n" + "    <server artifactsdir=\"artifacts\"/>\n"+ "    <pipelines>"+ "      <pipeline name=\"in_env\">"+ "         <materials> "+ "           <hg url=\"blah\"/>"+ "         </materials>  "+ "         <stage name=\"some_stage\">"+ "             <jobs>"+ "             <job name=\"some_job\">"+ "                 <tasks>"+ "                    <exec command=\"ls\"/>"+ "                 </tasks>"+ "             </job>"+ "             </jobs>"+ "         </stage>"+ "      </pipeline>"+ "      <pipeline name=\"not_in_env\">"+ "         <materials> "+ "           <hg url=\"blah\"/>"+ "         </materials>  "+ "         <stage name=\"some_stage\">"+ "             <jobs>"+ "             <job name=\"some_job\">"+ "                 <tasks>"+ "                    <exec command=\"ls\"/>"+ "                 </tasks>"+ "             </job>"+ "             </jobs>"+ "         </stage>"+ "      </pipeline>"+ "      <pipeline name=\"in_env_unLocked\" isLocked=\"false\">"+ "         <materials> "+ "           <hg url=\"blah\"/>"+ "         </materials>  "+ "         <stage name=\"some_stage\">"+ "             <jobs>"+ "             <job name=\"some_job\">"+ "                 <tasks>"+ "                    <exec command=\"ls\"/>"+ "                 </tasks>"+ "             </job>"+ "             </jobs>"+ "         </stage>"+ "      </pipeline>"+ "    </pipelines>"+ "    <environments>"+ "    <environment name=\"some_env\">"+ "        <pipelines>"+ "            <pipeline name=\"in_env\"/>"+ "            <pipeline name=\"in_env_unLocked\"/>"+ "        </pipelines>"+ "    </environment>"+ "    </environments>"+ " </cruise>";
  String migratedContent=migrateXmlString(content,22);
  assertThat(migratedContent,containsString("<pipeline isLocked=\"true\" name=\"in_env\">"));
  assertThat(migratedContent,containsString("<pipeline isLocked=\"false\" name=\"in_env_unLocked\">"));
  assertThat(migratedContent,containsString("<pipeline name=\"not_in_env\">"));
}
