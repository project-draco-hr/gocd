{
  when(licenseService.maximumUsersAllowed()).thenReturn(100);
  when(userDao.enabledUserCount()).thenReturn(10);
  when(userDao.findUser("new_user")).thenReturn(new NullUser());
  when(goConfigService.isOnlyKnownUserAllowedToLogin()).thenReturn(true);
  try {
    userService.addUserIfDoesNotExist(new Username(new CaseInsensitiveString("new_user")));
    fail("should have thrown OnlyKnownUsersAllowedException");
  }
 catch (  OnlyKnownUsersAllowedException e) {
    assertThat(e.getMessage(),is("Please ask the administrator to add you to Go"));
  }
}
