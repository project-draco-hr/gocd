{
  HttpLocalizedOperationResult result=new HttpLocalizedOperationResult();
  User foo=new User("fooUser","Foo User","foo@user.com");
  UserSearchModel searchModel=new UserSearchModel(foo,UserSourceType.LDAP);
  when(userDao.findUser("fooUser")).thenReturn(new NullUser());
  when(userDao.enabledUserCount()).thenReturn(10);
  when(licenseService.maximumUsersAllowed()).thenReturn(10);
  userService.create(Arrays.asList(searchModel),result);
  assertThat(result.isSuccessful(),is(false));
  assertThat(result.httpCode(),is(HttpServletResponse.SC_BAD_REQUEST));
  assertThat(result.localizable(),is((Localizable)LocalizedMessage.string("LICENSE_LIMIT_EXCEEDED")));
}
