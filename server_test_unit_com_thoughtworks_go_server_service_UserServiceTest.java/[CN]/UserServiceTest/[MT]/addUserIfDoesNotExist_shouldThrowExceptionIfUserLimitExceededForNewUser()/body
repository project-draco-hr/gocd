{
  Username user=new Username(new CaseInsensitiveString("user"));
  when(userDao.findUser(user.getUsername().toString())).thenReturn(new NullUser());
  when(goConfigService.isOnlyKnownUserAllowedToLogin()).thenReturn(false);
  when(licenseService.maximumUsersAllowed()).thenReturn(2);
  when(userDao.enabledUserCount()).thenReturn(2);
  try {
    userService.addUserIfDoesNotExist(user);
    Assert.fail();
  }
 catch (  UserLicenseLimitExceededException e) {
    assertThat(e.getMessage(),is("User license limit exceeded, please contact the administrator"));
  }
}
